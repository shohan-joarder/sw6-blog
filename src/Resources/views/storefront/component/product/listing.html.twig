{% sw_extends '@Storefront/storefront/component/product/listing.html.twig' %}

{% set currentPage = ((searchResult.criteria.offset + 1) / searchResult.criteria.limit )|round(0, 'ceil') %}
{% set paginationConfig = { page: currentPage }|json_encode %}



{% if disableEmptyFilter is not defined %}
    {% set disableEmptyFilter = config('core.listing.disableEmptyFilterOptions') %}
{% endif %}

{% set listingPagination = {
    sidebar: sidebar,
    params: params,
    dataUrl: dataUrl,
    filterUrl: filterUrl,
    disableEmptyFilter: disableEmptyFilter,
    snippets: {
        resetAllButtonText: 'listing.filterPanelResetAll'|trans|sw_sanitize
    }
} %}


{% block product_listing %}
    <div class="cms-element-product-listing-wrapper"
        data-listing-pagination="true"
        data-listing-pagination-options='{{ paginationConfig }}'
        data-listing="true"
        data-listing-options='{{ listingPagination|json_encode }}'>

        {% block element_product_listing_wrapper_content %}
            {% set defaultLayout = slot.translated.config.boxLayout.value %}

            {% set defaultLayout = slot.translated.config.boxLayout.value %}
            {% set boxLayoutBc = page.header.navigation.active.extensions.bcBoxLayout.data %}
            {% if (boxLayoutBc == null) %}
                {% set boxLayoutBc = app.session.get('boxLayoutBc') ?: 'standard' %}
            {% endif %}
            {% if boxLayoutBc == 'list'  %}
                {% set boxLayoutBc = 'standard' %}
            {% endif %}

            <template data-listing-style></template>
            <div class="cms-element-product-listing">
                {% if searchResult.total > 0 %}
                    {% block element_product_listing_pagination_nav_actions %}
                        <div class="cms-element-product-listing-actions row justify-content-between">
                            <div class="col-md-auto first-pagination">
                                {% block element_product_listing_pagination_nav_top %}
                                    {% sw_include '@Storefront/storefront/component/pagination.html.twig' with {
                                        entities: searchResult,
                                        criteria: searchResult.criteria
                                    } %}
                                    <div class="listing-top-text">
                                        {% if searchResult.total > 0 %}
                                            <div class="lbl">{{ "BrandCrockAquaTheme.listinglpage.pageCounts.title1"|trans|sw_sanitize }}</div>
                                            {{ searchResult.total }} {{ "BrandCrockAquaTheme.listinglpage.pageCounts.title2"|trans|sw_sanitize }}
                                        {% endif %}
                                    </div>
                                {% endblock %}

                            </div>

                            <div class="col-md-auto">
                                {% if searchResult.total > searchResult.limit %}
                                    {% block element_product_listing_pagination_nav_center %}
                                        {% sw_include '@Storefront/storefront/component/pagination.html.twig' with {
                                            entities: searchResult,
                                            criteria: searchResult.criteria,
                                        } %}
                                    {% endblock %}
                                {% endif %}
                            </div>

                            <div class="col-md-auto sort--box">
                                <form id="listing-style-form">
                                    <div class="listing-layout--wrapper">
                                        {% if app.session.get('boxLayout') %}

                                            <div class="col--1">
                                                <label class="labelMinimal {{ (app.session.get('boxLayout') == boxLayoutBc)?'active':'' }}">
                                                    <input type="radio" {{ (app.session.get('boxLayout') == boxLayoutBc)?'checked':'' }} name="boxLayout" value="{{boxLayoutBc}}"/>
                                                    <img src="{{ asset('/storefront/assets/images/icons/grid-icon.svg','@GISLEspadrillesTheme') }}" alt="{{boxLayoutBc}}" height="10" width="10">
                                                </label>
                                            </div>

                                            <div class="col--2">
                                                <label class="labellist  {{ (app.session.get('boxLayout') == 'custom')?'active':'' }}">
                                                    <input class="btn btn-primary-sm" type="radio" {{ (app.session.get('boxLayout') == 'custom')?'checked':'' }} name="boxLayout" value="custom"/>
                                                    <img src="{{ asset('/storefront/assets/images/icons/detail-icon.svg','@GISLEspadrillesTheme') }}" alt="list" height="10" width="10">
                                                </label>
                                            </div>

                                        {% else %}

                                            <label class="labelMinimal {{ (defaultLayout == boxLayoutBc)?'active':'' }}">
                                                <input type="radio" {{ (defaultLayout == boxLayoutBc)?'checked':'' }} name="boxLayout" value="{{boxLayoutBc}}"/>

                                                <img src="{{ asset('/storefront/assets/images/icons/grid-icon.svg','@GISLEspadrillesTheme') }}" alt="{{boxLayoutBc}}" height="10" width="10">
                                            </label>

                                            <label class="labellist {{ (defaultLayout == 'custom')?'active':'' }}">
                                                <input class="btn btn-primary-sm" type="radio" {{ (defaultLayout == 'custom')?'checked':'' }} name="boxLayout" value="custom"/>
                                                <img src="{{ asset('/storefront/assets/images/icons/detail-icon.svg','@GISLEspadrillesTheme') }}" alt="list" height="10" width="10">
                                            </label>

                                        {% endif %}
                                    </div>
                                </form>
                                {% block element_product_listing_sorting %}
                                    {% sw_include '@Storefront/storefront/component/sorting.html.twig' with {
                                        current: searchResult.sorting,
                                        sortings: searchResult.availableSortings
                                    } %}
                                {% endblock %}
                            </div>
                        </div>
                    {% endblock %}
                {% endif %}

                {% block element_product_listing_row %}
                    <div class="row cms-listing-row js-listing-wrapper">
                        {% if searchResult.total > 0 %}
                            {% block element_product_listing_col %}
                                {% for product in searchResult %}
                                    <div class="cms-listing-col {{ listingColumns }} {% if boxLayout == 'custom' %} listview-custom {% endif %}" >
                                        {% block element_product_listing_box %}
                                            {% sw_include '@Storefront/storefront/component/product/card/box.html.twig' with {
                                                'layout': boxLayout,
                                                'displayMode': displayMode
                                            } %}
                                        {% endblock %}
                                    </div>
                                {% endfor %}
                            {% endblock %}
                        {% else %}
                            {% block element_product_listing_col_empty %}
                                <div class="cms-listing-col col-12">
                                    {% block element_product_listing_col_empty_alert %}
                                        {% sw_include '@Storefront/storefront/utilities/alert.html.twig' with {
                                            type: 'info',
                                            content: 'listing.emptyResultMessage'|trans|sw_sanitize
                                        } %}
                                    {% endblock %}
                                </div>
                            {% endblock %}
                        {% endif %}
                    </div>
                {% endblock %}

                {% if searchResult.total > searchResult.limit %}
                    {% block element_product_listing_pagination_nav_bottom %}
                        {% sw_include '@Storefront/storefront/component/pagination.html.twig' with {
                            entities: searchResult,
                            criteria: searchResult.criteria,
                            paginationLocation: 'bottom',
                        } %}
                    {% endblock %}
                {% endif %}
            </div>
        {% endblock %}
    </div>
{% endblock %}
